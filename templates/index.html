<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SoulScribe - Daily Journal</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      background: #f7f9fe;
      font-family: 'Inter', sans-serif;
      color: #222;
    }

    /* Header Section */
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    .header h1 {
      font-weight: 700;
      font-size: 28px;
      color: #2b2b2b;
    }
    .header p {
      font-size: 15px;
      color: #555;
    }
    .date {
      text-align: left;
      font-size: 14px;
      color: #5a5a5a;
      margin-bottom: 10px;
    }

    /* Navbar */
    .nav-tabs {
      border: none;
      justify-content: center;
      margin-bottom: 25px;
    }
    .nav-tabs .nav-link {
      border: none;
      color: #444;
      font-weight: 500;
      padding: 10px 20px;
      border-radius: 6px;
    }
    .nav-tabs .nav-link.active {
      background: #f0edff;
      color: #6b4ce6;
      font-weight: 600;
    }

    /* Card */
    .card {
      border: none;
      border-radius: 14px;
      background: #fff;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    .card h4 {
      font-weight: 600;
      margin-bottom: 15px;
      font-size: 20px;
    }

    /* Textarea */
    textarea {
      border-radius: 10px;
      border: 1px solid #e0e0e0;
      resize: none;
    }

    /* Character Counter */
    small {
      font-size: 13px;
      color: #777;
    }

    /* Mood Slider */
    /* Mood Labels */
/*#mood-low.active { color: #e63946; font-weight: 700; }  */    /* Red */
/*#mood-neutral.active { color: #ffb703; font-weight: 700; } */  /* Yellow */
/* #mood-high.active { color: #2a9d8f; font-weight: 700; }    */ /* Green */

.mood-label {
  font-size: 15px;
  margin-bottom: 6px;
  transition: color 0.3s ease;
}

   #mood-low.active { color:#e63946; font-weight:700; }
#mood-neutral.active { color:#ffb703; font-weight:700; }
#mood-high.active { color:#2a9d8f; font-weight:700; }

/* show a filled track based on --value */
.form-range {
  --value: 50;
  background: linear-gradient(to right, #6b4ce6 0%, #6b4ce6 calc(var(--value)*1%), #e9ecef calc(var(--value)*1%), #e9ecef 100%);
  height: 8px;
  border-radius: 6px;
}
.form-range::-webkit-slider-runnable-track { background: transparent; }
.form-range::-moz-range-track { background: transparent; }
    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #777;
      margin-top: -8px;
    }

    /* Button */
    .save-btn {
      background-color: #b3a4f4;
      border: none;
      font-weight: 600;
      font-size: 15px;
      border-radius: 8px;
    }
    .save-btn:hover {
      background-color: #9e8de8;
    }

    /* AI Response */
    .ai-response {
      margin-top: 15px;
      background: #eef0fb;
      border-left: 4px solid #b3a4f4;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      color: #444;
    }
  </style>
</head>
<body>

<div class="container py-4">

  <!-- Date -->
  <div class="date">üìÖ Saturday, August 16, 2025</div>

  <!-- Header -->
  <div class="header">
    <h1>üß† SoulScribe</h1>
    <p>Your personal AI-powered mental health companion. Express your thoughts, 
       understand your emotions, and track your journey to well-being.</p>
  </div>

  <!-- Navigation Tabs -->
  <ul class="nav nav-tabs justify-content-center mb-4">
    <li class="nav-item"><a class="nav-link active" href="#">Journal</a></li>
    <li class="nav-item"><a class="nav-link" href="#">Voice</a></li>
    <li class="nav-item"><a class="nav-link" href="/calender">Calendar</a></li>
    <li class="nav-item"><a class="nav-link" href="#">Insights</a></li>
    <li class="nav-item"><a class="nav-link" href="#">Mindfulness</a></li>
    <li class="nav-item"><a class="nav-link" href="/history">History</a></li>
  </ul>

  <!-- Journal Card -->
  <div class="card p-4">
    <h4>‚ù§Ô∏è Daily Journal Entry</h4>
    <form id="journalForm">
      <div class="mb-3">
        <label class="form-label fw-semibold">How are you feeling today?</label>
        <textarea id="journalText" class="form-control" rows="6" placeholder="Share your thoughts, feelings, experiences, or anything on your mind. This is your safe space to express yourself freely..."></textarea>
        <small id="charCount">0 characters</small>

        <!-- AI Response -->
        <div id="aiResponse" class="ai-response" style="display: none;"></div>
      </div>

      <!-- Mood Slider -->
      <!-- Mood Slider -->
<div class="mb-3">
  <label class="mood-label fw-bold fs-6" id="moodLabel">‚ù§Ô∏è Overall Mood Level: Neutral</label>
  <input type="range" min="0" max="100" value="50" class="form-range" id="moodSlider" disabled>
  <div class="slider-labels d-flex justify-content-between text-muted small mt-1">
    <span id="mood-low">Very Low</span>
    <span id="mood-neutral">Neutral</span>
    <span id="mood-high">Blissful</span>
  </div>
</div>



      <!-- Save Button -->
      <button class="btn save-btn w-100 py-2" type="submit">üíæ Save Entry</button>
    </form>
  </div>
</div>

<!-- <script>
document.addEventListener("DOMContentLoaded", () => {
  const journalText = document.getElementById("journalText");
  const charCount = document.getElementById("charCount");
  const aiResponse = document.getElementById("aiResponse");
  const form = document.getElementById("journalForm");

  journalText.addEventListener("input", () => {
    charCount.textContent = `${journalText.value.length} characters`;
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const text = journalText.value.trim();
    if (!text) return;

    // Show "Thinking..." while waiting
    aiResponse.style.display = "block";
    aiResponse.textContent = "üí≠ Thinking...";

    try {
      const res = await fetch("/api/journal", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ entry: text })
      });
      const data = await res.json();
      aiResponse.textContent = `‚ú® SoulScribe: ${data.response}`;
    } catch (err) {
      aiResponse.textContent = "‚ö†Ô∏è Error connecting to AI.";
    }
  });
});
</script> -->


<!-- <script>
document.addEventListener("DOMContentLoaded", () => {
  const journalText = document.getElementById("journalText");
  const charCount = document.getElementById("charCount");
  const aiResponse = document.getElementById("aiResponse");
  const form = document.getElementById("journalForm");

  // Mood elements
  const moodLabel = document.querySelector(".mood-label");
  const moodSlider = document.querySelector(".form-range");

  journalText.addEventListener("input", () => {
    charCount.textContent = `${journalText.value.length} characters`;
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const text = journalText.value.trim();
    if (!text) return;

    // Show "Thinking..." while waiting
    aiResponse.style.display = "block";
    aiResponse.textContent = "üí≠ Thinking...";

    try {
      // --- Call AI Response API ---
      const res = await fetch("/api/journal", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ entry: text })
});

const data = await res.json();
console.log("API response:", data); // Debugging

if (data.response) {
  aiResponse.textContent = `‚ú® SoulScribe: ${data.response}`;
} else if (data.ai_response) {
  aiResponse.textContent = `‚ú® SoulScribe: ${data.ai_response}`;
} else {
  aiResponse.textContent = "‚ö†Ô∏è Something went wrong. Please try again.";
}

      // --- Call Mood Analysis API ---
      const moodRes = await fetch("/api/analyze_mood", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ entry: text })
      });
      const moodData = await moodRes.json();

      if (!moodData.error) {
  moodSlider.value = moodData.mood_score;
  moodLabel.textContent = `‚ù§Ô∏è Overall Mood Level: ${moodData.mood_label}`;

  // Reset label styles
  document.getElementById("mood-low").classList.remove("active");
  document.getElementById("mood-neutral").classList.remove("active");
  document.getElementById("mood-high").classList.remove("active");

  // Highlight based on mood_score
  if (moodData.mood_score < 40) {
    document.getElementById("mood-low").classList.add("active");
    moodLabel.style.color = "#e63946"; // red
  } else if (moodData.mood_score < 70) {
    document.getElementById("mood-neutral").classList.add("active");
    moodLabel.style.color = "#ffb703"; // yellow
  } else {
    document.getElementById("mood-high").classList.add("active");
    moodLabel.style.color = "#2a9d8f"; // green
  }
}




    } catch (err) {
      aiResponse.textContent = "‚ö†Ô∏è Error connecting to AI.";
    }
  });
});
</script> -->

<script>
document.addEventListener("DOMContentLoaded", () => {
  const journalText = document.getElementById("journalText");
  const charCount = document.getElementById("charCount");
  const aiResponse = document.getElementById("aiResponse");
  const form = document.getElementById("journalForm");

  // Mood UI
  const moodLabel = document.querySelector(".mood-label");
  const moodSlider = document.querySelector(".form-range");
  const moodLow = document.getElementById("mood-low");
  const moodNeutral = document.getElementById("mood-neutral");
  const moodHigh = document.getElementById("mood-high");

  // helper: highlight label + color the header label
  function applyMoodUI(score, label) {
    moodSlider.value = score;
    moodLabel.textContent = `‚ù§Ô∏è Overall Mood Level: ${label}`;

    [moodLow, moodNeutral, moodHigh].forEach(el => el.classList.remove("active"));
    if (score < 40) {
      moodLow.classList.add("active");
      moodLabel.style.color = "#e63946";   // red
    } else if (score < 70) {
      moodNeutral.classList.add("active");
      moodLabel.style.color = "#ffb703";   // yellow
    } else {
      moodHigh.classList.add("active");
      moodLabel.style.color = "#2a9d8f";   // green
    }

    // optional: fill the track visually
    moodSlider.style.setProperty("--value", score);
  }

  journalText.addEventListener("input", () => {
    charCount.textContent = `${journalText.value.length} characters`;
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const text = journalText.value.trim();
    if (!text) return;

    aiResponse.style.display = "block";
    aiResponse.textContent = "üí≠ Thinking...";

    try {
      // 1) AI response
      const res = await fetch("/api/journal", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ entry: text })
      });

      // handle non-JSON or error statuses gracefully
      let aiData = null, aiText = null;
      if (!res.ok) {
        // try to read JSON error; else read text
        try { aiData = await res.json(); } catch { aiText = await res.text(); }
        const msg = aiData?.error || aiText || `HTTP ${res.status}`;
        aiResponse.textContent = `‚ö†Ô∏è AI error: ${msg}`;
        return;
      } else {
        aiData = await res.json();
      }

      const aiReply = aiData?.response || aiData?.ai_response;
      if (!aiReply) {
        aiResponse.textContent = "‚ö†Ô∏è AI returned no message.";
        return;
      }
      aiResponse.textContent = `‚ú® SoulScribe: ${aiReply}`;

      // 2) Mood analysis
      const moodRes = await fetch("/api/analyze_mood", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ entry: text })
      });
      if(!moodRes.ok) {
        throw new Error(`Mood API error: ${moodRes.status}`);
      }

      let moodData = null;
      if (moodRes.ok) {
        moodData = await moodRes.json();
        if (!moodData.error) {
          applyMoodUI(moodData.mood_score, moodData.mood_label);
        }
      } else {
        // don't block saving if mood API fails
        console.warn("Mood API failed", await moodRes.text());
      }
      //moodData=await moodRes.json();
      // 3) Save to DB (uses session user_id on the server)
      const saveRes = await fetch("/api/save_entry", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          entry: text,
          ai_response: aiReply,
          mood:moodData.mood_label
        })
      });

      if (!saveRes.ok) {
        let errJson = null, errText = null;
        try { errJson = await saveRes.json(); } catch { errText = await saveRes.text(); }
        console.warn("Save failed:", errJson?.error || errText || saveRes.status);
        // keep UI response visible even if save fails
      }

    } catch (err) {
      console.error(err);
      aiResponse.textContent = "‚ö†Ô∏è Network error. Please try again.";
    }
  });
});
</script>



</body>
</html>
